<!doctype html>
<html>
<head>
  <meta charset='utf-8' />
  <title>com.phonegap.biddingbox03 1.0.0 | Documentation</title>
  <meta name='viewport' content='width=device-width,initial-scale=1'>
  <link href='assets/bass.css' type='text/css' rel='stylesheet' />
  <link href='assets/style.css' type='text/css' rel='stylesheet' />
  <link href='assets/github.css' type='text/css' rel='stylesheet' />
  <link href='assets/split.css' type='text/css' rel='stylesheet' />
  <meta name='description' content='This is gives boilerplate app using materialize, jQuery, material fonts, bluetooth plugin.'>
</head>
<body class='documentation m0'>
    <div class='flex'>
      <div id='split-left' class='overflow-auto fs0 height-viewport-100'>
        <div class='py1 px2'>
          <h3 class='mb0 no-anchor'>com.phonegap.biddingbox03</h3>
          <div class='mb1'><code>1.0.0</code></div>
          <input
            placeholder='Filter'
            id='filter-input'
            class='col12 block input'
            type='text' />
          <div id='toc'>
            <ul class='list-reset h5 py1-ul'>
              
                
                <li><a
                  href='#handletricksbid'
                  class="">
                  handleTricksBid
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#handlecalls'
                  class="">
                  handleCalls
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#initbtsettingspage'
                  class="">
                  initBtSettingsPage
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#getbtdevices'
                  class="">
                  getBtDevices
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#assignbtfunction'
                  class="">
                  assignBtFunction
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#makebtconnection'
                  class="">
                  makeBtConnection
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#startbtlistening'
                  class="">
                  startBtListening
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#onbtacceptconnectionhandler'
                  class="">
                  onBtAcceptConnectionHandler
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#chainbtclientconnection'
                  class="">
                  chainBtClientConnection
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#trybtclientconnection'
                  class="">
                  tryBtClientConnection
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#setbtconnectionstate'
                  class="">
                  setBtConnectionState
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#generalbtreset'
                  class="">
                  generalBtReset
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#dobtreset'
                  class="">
                  doBtReset
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#findnextunconnectedclient'
                  class="">
                  findNextUnconnectedClient
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#promptnewboard'
                  class="">
                  promptNewBoard
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#startnewboard'
                  class="">
                  startNewBoard
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#setnewboard'
                  class="">
                  setNewBoard
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#resetbiddingbox'
                  class="">
                  resetBiddingBox
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#drawcompass'
                  class="">
                  drawCompass
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#getseatixfromname'
                  class="">
                  getSeatIxFromName
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#disablebbcontrolinput'
                  class="">
                  disableBBControlInput
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#enablebbcontrolinput'
                  class="">
                  enableBBControlInput
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#checkmessagedestination'
                  class="">
                  checkMessageDestination
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#sendmessage'
                  class="">
                  sendMessage
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#sendseatidtoserver'
                  class="">
                  sendSeatIdToServer
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#onbtreceivehandler'
                  class="">
                  onBtReceiveHandler
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#msginterpreter'
                  class="">
                  msgInterpreter
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#pping'
                  class="">
                  pping
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#sendbid'
                  class="">
                  sendBid
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#sendnewboardnotice'
                  class="">
                  sendNewBoardNotice
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#drawbiddingrecordtable'
                  class="">
                  drawBiddingRecordTable
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#updatebiddingrecord'
                  class="">
                  updateBiddingRecord
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#makebidrecordentry'
                  class="">
                  makeBidRecordEntry
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#makebidtableentry'
                  class="">
                  makeBidTableEntry
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#storeexternalbid'
                  class="">
                  storeExternalBid
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#getbstat'
                  class="">
                  getbStat
                  
                </a>
                
                </li>
              
            </ul>
          </div>
          <div class='mt1 h6 quiet'>
            <a href='https://documentation.js.org/reading-documentation.html'>Need help reading this?</a>
          </div>
        </div>
      </div>
      <div id='split-right' class='relative overflow-auto height-viewport-100'>
        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='handletricksbid'>
      handleTricksBid
    </h3>
    
    
  </div>
  

  <p>Called when the bidder selects a nbr of tricks. <br>
The selection is provisional until bidder confirms. <br>
Selecting a selected button will undo all current choices <br></p>

 
  
    <div class='pre p1 fill-light mt0'>handleTricksBid(idTricks: int)</div>
   
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>idTricks</span> <code class='quiet'>(int)</code>
	    Number of tricks, i.e. bidding level

          </div>
          
        </div>
      
    </div>
  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='handlecalls'>
      handleCalls
    </h3>
    
    
  </div>
  

  
 
  
    <div class='pre p1 fill-light mt0'>handleCalls(idCall: any)</div>
   
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>idCall</span> <code class='quiet'>(any)</code>
	    
          </div>
          
        </div>
      
    </div>
  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='initbtsettingspage'>
      initBtSettingsPage
    </h3>
    
    
  </div>
  

  <p>Visual initialization of the BT settings page <br>
This Tablet: "Client" or "Server" and this-tablet-name <br>
Server Tablet: tablet BT name from GetBtDevices <br>
Client Tablets: tablet BT names from GetBtDevices <br>
The server knows all 4 names, 3 from pairing <br>
Each client knows its own name and the server name from pairing <br></p>

 
  
    <div class='pre p1 fill-light mt0'>initBtSettingsPage()</div>
   
  
  

  
  
  
  
  
  

  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='getbtdevices'>
      getBtDevices
    </h3>
    
    
  </div>
  

  <p>Get Adapter State and name and list of paired devices<br>
The names are then entered into the page slots<br>
Initial connection state set to "disconnected"<br>
Called after Phonegap event "deviceready" has been fired<br>
Compass is refreshed<br></p>

 
  
    <div class='pre p1 fill-light mt0'>getBtDevices()</div>
   
  
  

  
  
  
  
  
  

  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='assignbtfunction'>
      assignBtFunction
    </h3>
    
    
  </div>
  

  <p>Called by getDevices <br><br></p>
<p>If this is a client there is only 1 name and 1 addr <br>
If this is a server there are 3 <br><br></p>
<p>Initializes the tablet array and assigns seatIx so that <br>
tablet[].seatIx = 0,1,2,3  ~ N,E,S,W ~ (charCode + 3)(mod 4) <br>
i.e. the initial NSEW assignments come from the tablet names <br>
where charCode is the ASCII numerical code of the last character <br>
Thus last character (1,2,3,4) -> (N,E,S,W) <br><br></p>
<p>tablet[] array initialization: <br>
if this is a client (i.e. names&#x26;address list length = 1) <br>
serverTabletIx = 0; <br>
thisTabletIx = 1; <br></p>
<p>tablet[0].type = "server" <br>
tablet[0].seatIx = from names[0] <br>
tablet[1].type = "client" <br>
tablet[1].seatIx = from thisTabletBtName <br>
also sets name, address, uuid, socket = -1 <br><br></p>
<p>if this is the server (i.e. names&#x26;address list length = 3) <br>
serverTabletIx = 0; <br>
thisTabletIx = 0; <br>
tablet[0].type = "server" <br>
tablet[i].type = "clienti" <br>
etc as above for client <br></p>

 
  
    <div class='pre p1 fill-light mt0'>assignBtFunction(names: <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>, addresses: <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>)</div>
   
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>names</span> <code class='quiet'>(<a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>)</code>
	    Array of names of paired BT devices

          </div>
          
        </div>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>addresses</span> <code class='quiet'>(<a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>)</code>
	    Array of paired BT addresses

          </div>
          
        </div>
      
    </div>
  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='makebtconnection'>
      makeBtConnection
    </h3>
    
    
  </div>
  

  <p>Called directly from onClick "Connect" on the Bluetooth page <br>
Called also through a modal prompt on either server or client <br>
If server: finds next unconnected client and calls startBtListening(tabIx), sets waiting state <br>
If client: sets the correct waiting state and calls chainBtClentConnection() <br></p>

 
  
    <div class='pre p1 fill-light mt0'>makeBtConnection()</div>
   
  
  

  
  
  
  
  
  

  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='startbtlistening'>
      startBtListening
    </h3>
    
    
  </div>
  

  <p>This is the 'server' side, of the socket connection <br>
The 'server' (listener) is an arbitrarily chosen tablet <br>
The server must be paired with the 3 clients and no other BT devices <br>
Each client is paired with the server and no other BT devices <br>
The 'clients' request a connection (callers) <br>
If tabIx &#x3C;= 0 do nothing <br></p>

 
  
    <div class='pre p1 fill-light mt0'>startBtListening(tabIx: int)</div>
   
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>tabIx</span> <code class='quiet'>(int)</code>
	    The tablet array index

          </div>
          
        </div>
      
    </div>
  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='onbtacceptconnectionhandler'>
      onBtAcceptConnectionHandler
    </h3>
    
    
  </div>
  

  <p>Callback for networking.bluetooth.onAccept.addListener(callback) <br>
Handles incoming connection requests from client tablets <br></p>

 
  
    <div class='pre p1 fill-light mt0'>onBtAcceptConnectionHandler(acceptInfo: obj)</div>
   
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>acceptInfo</span> <code class='quiet'>(obj)</code>
	    
          </div>
          
        </div>
      
    </div>
  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='chainbtclientconnection'>
      chainBtClientConnection
    </h3>
    
    
  </div>
  

  <p>This is the function called to make a connection from  <br>
client to server. The server must be "listening", the <br>
client is said to be "calling". <br>
There are 4 uuid's and all 4 are tried in succession. <br>
The connection can succeed only if the server is listening <br>
for the correct uuid; so the server changes uuid after each <br>
successful connection. <br>
If the connection attempt fails the tryClient function returns <br>
with an implicit parameter that gives the index of the next uuid to try <br></p>

 
  
    <div class='pre p1 fill-light mt0'>chainBtClientConnection()</div>
   
  
  

  
  
  
  
  
  

  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='trybtclientconnection'>
      tryBtClientConnection
    </h3>
    
    
  </div>
  

  <p>Client Connection using chained promise for retry <br>
Called for each try from chainBtClientConnection() <br>
Each time with the next uuid Index (there are currently 4) <br>
uuid[] is a global array - same on all tablets <br></p>

 
  
    <div class='pre p1 fill-light mt0'>tryBtClientConnection(uuidIx: int)</div>
   
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>uuidIx</span> <code class='quiet'>(int)</code>
	    Index of the uuid to be tried

          </div>
          
        </div>
      
    </div>
  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='setbtconnectionstate'>
      setBtConnectionState
    </h3>
    
    
  </div>
  

  <p>The function changes the class of the corresponding element <br>
in order to display the  red, yellow or green symbol <br>
This affects the visuals only, i.e. the red, yellow, green dots on the BT page <br>
These indicators occur on each page in the urh corner and on the BT page <br></p>

 
  
    <div class='pre p1 fill-light mt0'>setBtConnectionState(tab: any, state: any)</div>
   
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>tab</span> <code class='quiet'>(any)</code>
	    tablet: "this", "server", "client1", "client2", or "client3"

          </div>
          
        </div>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>state</span> <code class='quiet'>(any)</code>
	    "disconnected", "waiting", "connected", or "unset"

          </div>
          
        </div>
      
    </div>
  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='generalbtreset'>
      generalBtReset
    </h3>
    
    
  </div>
  

  <p>Brings up a dialog box, and if accepted doBtReset() is called <br>
This clears the Bluetooth system and starts over <br>
Try to make the same connections as before <br></p>

 
  
    <div class='pre p1 fill-light mt0'>generalBtReset()</div>
   
  
  

  
  
  
  
  
  

  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='dobtreset'>
      doBtReset
    </h3>
    
    
  </div>
  

  <p>General reset of the Bluetooth Connections <br>
Called after popupBox thru generalBtReset() <br></p>

 
  
    <div class='pre p1 fill-light mt0'>doBtReset()</div>
   
  
  

  
  
  
  
  
  

  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='findnextunconnectedclient'>
      findNextUnconnectedClient
    </h3>
    
    
  </div>
  

  <p>Get index of the first tablet structure that doesn't <br>
have a socket assigned. The criterion is tablet[].socket = -1. <br>
This is used to start listening for the corresponding <br>
client connection using the appropriate uuid <br></p>

 
  
    <div class='pre p1 fill-light mt0'>findNextUnconnectedClient()</div>
   
  
  

  
  
  
  
  
  

  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='promptnewboard'>
      promptNewBoard
    </h3>
    
    
  </div>
  

  <p>Called from onClickHandler for new board <br>
If this is the controlling tablet send a message to each of the other 3 tablets <br>
All four are then initialized <br>
All four are alerted by a popup, the bidder is asked to bid <br>
boardNbr and bidderIx were already set <br></p>

 
  
    <div class='pre p1 fill-light mt0'>promptNewBoard()</div>
   
  
  

  
  
  
  
  
  

  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='startnewboard'>
      startNewBoard
    </h3>
    
    
  </div>
  

  <p>Called from OK exit of Starting New Board Popup <br>
on the board controller tablet <br>
Send notice of new board to other 3 tablets <br>
All 4 boards the will call setNewBoard <br></p>

 
  
    <div class='pre p1 fill-light mt0'>startNewBoard()</div>
   
  
  

  
  
  
  
  
  

  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='setnewboard'>
      setNewBoard
    </h3>
    
    
  </div>
  

  <p>Called from startNewBoard after all 4 tablets have been notified <br></p>

 
  
    <div class='pre p1 fill-light mt0'>setNewBoard(bNbr: int)</div>
   
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>bNbr</span> <code class='quiet'>(int)</code>
	    New board number

          </div>
          
        </div>
      
    </div>
  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='resetbiddingbox'>
      resetBiddingBox
    </h3>
    
    
  </div>
  

  <p>Needs description</p>

 
  
    <div class='pre p1 fill-light mt0'>resetBiddingBox()</div>
   
  
  

  
  
  
  
  
  

  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='drawcompass'>
      drawCompass
    </h3>
    
    
  </div>
  

  <p>Redraw the Compass svg using current values of <br>
the globals for board, table etc. <br>
This is a refresh action callable at any time (even periodically) <br></p>

 
  
    <div class='pre p1 fill-light mt0'>drawCompass()</div>
   
  
  

  
  
  
  
  
  

  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='getseatixfromname'>
      getSeatIxFromName
    </h3>
    
    
  </div>
  

  <p>Takes the charcode of the last character of tablet name and converts <br>
it to an integer so that remainder mod 4 = endInt. <br>
Then seatIx = (endInt + 3) mod 4  <br>
this makes 1,2,3,4 &#x3C;-> N,E,S,W  <br>
Returns value of seatIx <br></p>

 
  
    <div class='pre p1 fill-light mt0'>getSeatIxFromName(strName: <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>): int</div>
   
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>strName</span> <code class='quiet'>(<a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>)</code>
	    
          </div>
          
        </div>
      
    </div>
  

  

  
    
      <div class='py1 quiet mt1 prose-big'>Returns</div>
      <code>int</code>:
        seatIx

      
    
  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='disablebbcontrolinput'>
      disableBBControlInput
    </h3>
    
    
  </div>
  

  <p>The buttons controlling the next board to be played are <br>
disabled while the hand is being bid <br></p>

 
  
    <div class='pre p1 fill-light mt0'>disableBBControlInput()</div>
   
  
  

  
  
  
  
  
  

  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='enablebbcontrolinput'>
      enableBBControlInput
    </h3>
    
    
  </div>
  

  <p>Enable the Board number selection mechanism <br>
Active only between boards being bid <br></p>

 
  
    <div class='pre p1 fill-light mt0'>enableBBControlInput()</div>
   
  
  

  
  
  
  
  
  

  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='checkmessagedestination'>
      checkMessageDestination
    </h3>
    
    
  </div>
  

  <p>Translate the destination code acc to message tag</p>

 
  
    <div class='pre p1 fill-light mt0'>checkMessageDestination(rcvCode: <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>, tag: any): <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a></div>
   
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>rcvCode</span> <code class='quiet'>(<a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>)</code>
	    
          </div>
          
        </div>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>tag</span> <code class='quiet'>(any)</code>
	    
          </div>
          
        </div>
      
    </div>
  

  

  
    
      <div class='py1 quiet mt1 prose-big'>Returns</div>
      <code><a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a></code>:
        newCode

      
    
  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='sendmessage'>
      sendMessage
    </h3>
    
    
  </div>
  

  <p>Sending a message requires <br></p>
<ul>
<li>finding the socketId of the recipient <br></li>
<li>constructing the text to be transmissed <br></li>
</ul>
<p>The text is a stringified JSON object:<br></p>
<ul>
<li>objContent.from = sndCode<br></li>
<li>objContent.to = recipient<br></li>
<li>objContent.tag = tag<br></li>
<li>objContent.text = msgText<br></li>
</ul>

 
  
    <div class='pre p1 fill-light mt0'>sendMessage(sndCode: <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>, rcvCode: <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>, tag: <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>, msgText: <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>)</div>
   
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>sndCode</span> <code class='quiet'>(<a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>)</code>
	    "this" when this tablet is the originator 
<br>
<br>


"client1", "client2", "client3" when this is the server relaying a msg 
<br>
<br>


"North", "East", "South", "West"
<br>

          </div>
          
        </div>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>rcvCode</span> <code class='quiet'>(<a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>)</code>
	    "server", "client1", "client2", "client3"  
<br>

"North", "East", "South", "West"  
<br>

'R', 'L', 'P', 'M' = RHO, LHO, Partner, Screenmate 
<br>

          </div>
          
        </div>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>tag</span> <code class='quiet'>(<a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>)</code>
	    that determines what is to be done with the text by the receiver 
<br>

          </div>
          
        </div>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>msgText</span> <code class='quiet'>(<a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>)</code>
	    the actual message; interpreted accto tag; a stringified JSON object 
<br>
<br>


if = "" the text from the "outgoing message" field is sent
<br>

          </div>
          
        </div>
      
    </div>
  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='sendseatidtoserver'>
      sendSeatIdToServer
    </h3>
    
    
  </div>
  

  <p>Message from client to server when the seat id is changed <br>
(not yet in use) <br></p>

 
  
    <div class='pre p1 fill-light mt0'>sendSeatIdToServer()</div>
   
  
  

  
  
  
  
  
  

  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='onbtreceivehandler'>
      onBtReceiveHandler
    </h3>
    
    
  </div>
  

  <p>Called when a message was received, i.e. in response to onReceive Event <br>
Outputs the raw message string to the HTML field on the BT page    <br>
objReceived = JSON object &#x3C;= parsed JSON string &#x3C;= receiveInfo.data  <br>
Calls msgInterpreter which handles input acc to message content  <br>
The message text contains the "msg type" information, i.e. what to do next <br></p>

 
  
    <div class='pre p1 fill-light mt0'>onBtReceiveHandler(receiveInfo: <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer">arrayBuffer</a>)</div>
   
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>receiveInfo</span> <code class='quiet'>(<a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer">arrayBuffer</a>)</code>
	    
          </div>
          
        </div>
      
    </div>
  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='msginterpreter'>
      msgInterpreter
    </h3>
    
    
  </div>
  

  <p>Most incoming messages require action <br><br>
An example is the msg that communicates the client name  <br><br>
allowing the server to associate it with a socket.   <br>
msgObj.tag determines what to do.   <br>
The remainder of the function is specific to each message type <br></p>

 
  
    <div class='pre p1 fill-light mt0'>msgInterpreter(socketId: <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number">number</a>, strMsg: <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>)</div>
   
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>socketId</span> <code class='quiet'>(<a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number">number</a>)</code>
	    = receiving socket on this table

          </div>
          
        </div>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>strMsg</span> <code class='quiet'>(<a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>)</code>
	    = string as received, unparsed stringified JSON object

          </div>
          
        </div>
      
    </div>
  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='pping'>
      pping
    </h3>
    
    
  </div>
  

  <p>This is a diagostic function to check that communication works <br>
Ping causes a message of type "ping" to be sent to the receiver  <br>
recipient = "server", "client1", "client2", "client3" <br>
or "north", "south","east","west" <br>
The message text, if any, comes from the msg input field  <br>
The recipient responds by displaying a modal popup with the text <br></p>

 
  
    <div class='pre p1 fill-light mt0'>pping(recipient: <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>)</div>
   
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>recipient</span> <code class='quiet'>(<a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>)</code>
	    
          </div>
          
        </div>
      
    </div>
  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='sendbid'>
      sendBid
    </h3>
    
    
  </div>
  

  <p>Send a bid to another tablet <br>
The parameters specifying board, round, bidder are the indices in boardsRec[][][] <br></p>

 
  
    <div class='pre p1 fill-light mt0'>sendBid(rcvCode: <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>, brdIx: int, rndIx: int, bidIx: int)</div>
   
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>rcvCode</span> <code class='quiet'>(<a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>)</code>
	    'R', 'L', 'P', 'M' meaning rho, lho, partner, screenmate 
<br>

          </div>
          
        </div>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>brdIx</span> <code class='quiet'>(int)</code>
	    Board index

          </div>
          
        </div>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>rndIx</span> <code class='quiet'>(int)</code>
	    Round index

          </div>
          
        </div>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>bidIx</span> <code class='quiet'>(int)</code>
	    Bidder index

          </div>
          
        </div>
      
    </div>
  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='sendnewboardnotice'>
      sendNewBoardNotice
    </h3>
    
    
  </div>
  

  <p>When a new board is started the newBoardControlSeat sends <br>
a message to each of the other boards: <br>
From the onClickHandler for the new board <br></p>
<ul>
<li>Call this function to notify the other 3 players <br></li>
<li>On each tablet initialize the bidding box <br></li>
<li>Prompt the dealer to bid  <br></li>
</ul>

 
  
    <div class='pre p1 fill-light mt0'>sendNewBoardNotice(nbr: int, ix: int)</div>
   
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>nbr</span> <code class='quiet'>(int)</code>
	    Board Number

          </div>
          
        </div>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>ix</span> <code class='quiet'>(int)</code>
	    Board Index in the boardRecord array

          </div>
          
        </div>
      
    </div>
  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='drawbiddingrecordtable'>
      drawBiddingRecordTable
    </h3>
    
    
  </div>
  

  <p>Draw an empty table with header and nRows rows of 4 cells <br></p>

 
  
    <div class='pre p1 fill-light mt0'>drawBiddingRecordTable(nRows: int)</div>
   
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>nRows</span> <code class='quiet'>(int)</code>
	    
          </div>
          
        </div>
      
    </div>
  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='updatebiddingrecord'>
      updateBiddingRecord
    </h3>
    
    
  </div>
  

  <p>Adds the most recent bid to the table <br>
Info comes from bStat; the table entry coordinates <br>
from the corresponding round and boardRounds <br></p>

 
  
    <div class='pre p1 fill-light mt0'>updateBiddingRecord()</div>
   
  
  

  
  
  
  
  
  

  

  

  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='makebidrecordentry'>
      makeBidRecordEntry
    </h3>
    
    
  </div>
  

  <p>Construct the text to be shown in the table cell <br>
The information comes from the "new" part of bStat <br></p>

 
  
    <div class='pre p1 fill-light mt0'>makeBidRecordEntry(): any</div>
   
  
  

  
  
  
  
  
  

  

  

  
    
      <div class='py1 quiet mt1 prose-big'>Returns</div>
      <code>any</code>:
        string newEntry 
<br>

The string consists of 3 
<span>
 elements and goes into the innerHTML 
<br>

of the current cell 
<br>

      
    
  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='makebidtableentry'>
      makeBidTableEntry
    </h3>
    
    
  </div>
  

  <p>Makes the actual HTML for the bidding table cell <br></p>

 
  
    <div class='pre p1 fill-light mt0'>makeBidTableEntry(nTricks: int, cSuit: <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>, nCall: <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>): any</div>
   
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>nTricks</span> <code class='quiet'>(int)</code>
	    Bidding Level or 0 
<br>

          </div>
          
        </div>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>cSuit</span> <code class='quiet'>(<a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>)</code>
	    Suit bid 
<br>

          </div>
          
        </div>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>nCall</span> <code class='quiet'>(<a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>)</code>
	    X, XX, Pass and then ntricks = 0 
<br>

          </div>
          
        </div>
      
    </div>
  

  

  
    
      <div class='py1 quiet mt1 prose-big'>Returns</div>
      <code>any</code>:
        string newEntry for direct insertion into DOM

      
    
  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='storeexternalbid'>
      storeExternalBid
    </h3>
    
    
  </div>
  

  <p>Called after "new-bid" external message received<br>
Calls setBiddingRecordCell(msgObj)<br></p>

 
  
    <div class='pre p1 fill-light mt0'>storeExternalBid(msgObj: obj): any</div>
   
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>msgObj</span> <code class='quiet'>(obj)</code>
	    = {tricks: int, suit: int, alert: 
<not used>
}

          </div>
          
        </div>
      
    </div>
  

  

  
    
      <div class='py1 quiet mt1 prose-big'>Returns</div>
      <code>any</code>:
        newCall displayable format of the bid

      
    
  

  

  

  

  

  
</section>

        
          
          <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='getbstat'>
      getbStat
    </h3>
    
    
  </div>
  

  <p>Called when player is prompted to bid. <br>
The bidding status is a structure that contains all the information <br>
necessary to manage the bidding box. This initialization obtains the <br>
necessary info from the bidding record contents, which is contained <br>
in the boardsRec array. <br></p>
<p>The state of the bidding: bStat <br>
lastBidder: "ME", "PA", "LH", "RH", "NO"  <br>
tricks: #d the bid level  <br>
suit: "C", "D", "H", "S", "NT", "none"  <br>
dbl and rdble: true/false  <br>
var bStat = {lastBidder: "NO", tricks: 0, suit: "none", dbl: false,  <br>
rdbl: false, newTricks: 0, newSuit: "none", newCall: "none", newAlert: false};  <br></p>
<p>further, the bStat structure contains the current (unconfirmed)  <br>
(tricks,suit,call) selections:  <br>
newTricks: 0, newSuit: "none", newCall: "none", newAlert: false  <br></p>

 
  
    <div class='pre p1 fill-light mt0'>getbStat()</div>
   
  
  

  
  
  
  
  
  

  

  

  

  

  

  

  

  
</section>

        
      </div>
    </div>
  <script src='assets/anchor.js'></script>
  <script src='assets/split.js'></script>
  <script src='assets/site.js'></script>
</body>
</html>
